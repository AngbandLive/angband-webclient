<!DOCTYPE html>
<html>
  <head>
    <title>Angband Live</title>
	<meta name="description" content="Web based client for playing Angband and select variants remotely. Supports recording and live spectating.">
	<link rel='stylesheet' href='/style.css' />
	<script src="term.js" ></script>
	<script src="/main.js"></script>
  </head>
  <body>
	<% if (typeof(user) == 'undefined') { %>
		<img id="logo" src="logo.png"></img>
		<form id="login-form" method="post">
			<label>Username:</label>
			<input type="text" name="username"/></br>
			<label>Password:</label>
			<input type="password" name="password"/></br>
		</form>
		<button type="submit" onclick="signIn()">Sign in</button>
		<script>
			var loginform = document.getElementById("login-form");
			function signIn(){
				loginform.action = "/signin";
				loginform.submit();
			}
		</script>
	<% } else { %>
		<div id="container">
				<div id="terminal-container">
					<img id="logo" src="logo.png"></img>
					<div id="playmenu">
						<label>Game:</label>
						<select id="gameselect">
						</select>
						<div id="gamedescription"></div>
						<label style="display:none;">columns</label><input style="display:none;" id="columns" type="number" min="80" max="215">
						<label style="display:none;">rows</label><input style="display:none;" id="rows" type="number" min="47" max="66">
						<label>subwindows</label><input id="panels" type="number" min="1" max="6" value="1">
						<button id="playbutton">Play</button>
					</div>
					<div id="watchmenu">
						<%= JSON.stringify(livematches) %>
					</div>
				</div>
				<div id="menu">
				<div id="settings">
					<div id="userinfo">
						Logged in as <span id="username"><%= user.username%></span> <a href="/logout">Log Out</a>
					</div>
					<div id="usercount">Users online:</div>
					<label>Font:</label>
					<select id="fontselect">
						<option value='"Consolas", monospace'>Consolas</option>
						<option value='"Courier", monospace'>Courier</option>
						<option value='"DejaVu Sans Mono", monospace'>DejaVu Sans Mono</option>
						<option value='"Lucida Console", monospace'>Lucida Console</option>
					</select> 
				</div>
				<% if (user.username=='Gwarl') { %>
					<div id="debug">
					</div>
				<% } %>
				<div id="files">
					<%= JSON.stringify(files) %>
				</div>
				<div id="chat">
					<div id="chatlog"></div>
					<input type="text" id="chatmessage"></textarea>
					<button id="sendchat">Send</button>
				</div>
				</div>
		</div>
		<script>
			document.getElementById('fontselect').onchange = function(){
				document.body.style.fontFamily=document.getElementById('fontselect').value;
				adjustsize();
			};
			document.body.style.fontFamily=document.getElementById('fontselect').value;
			initmeta();
			listmatches();
			initcontrols();
			adjustsize();
		</script>
	<% } %>
  </body>
</html>